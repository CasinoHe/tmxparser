cmake_minimum_required(VERSION 2.8)
project(tmxparser)
set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake ${CMAKE_MODULE_PATH})

set(VERSION_MAJOR 1)
set(VERSION_MINOR 0)
set(VERSION_PATCH 0)

set(VERSION "${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_PATCH}")
message("Configuring tmxparser version ${VERSION}")

file(GLOB_RECURSE SOURCES ${PROJECT_SOURCE_DIR}/src/*.cpp)
file(GLOB_RECURSE HEADERS ${PROJECT_SOURCE_DIR}/src/*.h)

if (NOT DEFINED TINYXML_LIBRARIES)
  find_package(TinyXML REQUIRED)
  if (not TinyXML_FOUND)
    message(FATAL_ERROR "tinyxml package not found. You need set TINYXML_LIBRARIES and TINYXML_INCLUDE_DIRS variables manually")
  endif()
else()
  message(STATUS "find tinyxml libraries: ${TINYXML_LIBRARIES}")
endif()

if (NOT DEFINED ZLIB_LIBRARIES)
  find_package(ZLIB)
  if (not ZLIB_FOUND)
    message(FATAL_ERROR "zlib package not found. You need set ZLIB_LIBRARIES and ZLIB_INCLUDE_DIRS variables manually")
  endif()
else()
  message(STATUS "find zlib libraries: ${ZLIB_LIBRARIES}")
endif()

add_library(tmxparser_static STATIC ${SOURCES} ${HEADERS})
set_target_properties(tmxparser_static PROPERTIES OUTPUT_NAME tmxparser)

add_library(tmxparser SHARED ${SOURCES} ${HEADERS})
set_target_properties(tmxparser PROPERTIES
  SOVERSION ${VERSION_MAJOR}
  VERSION ${VERSION})

target_link_libraries(tmxparser ${TINYXML_LIBRARIES} ${ZLIB_LIBRARIES})
include_directories(${TINYXML_INCLUDE_DIR} ${ZLIB_INCLUDE_DIRS})

add_executable(test test/test.cpp)
target_link_libraries(test tmxparser)

install(FILES ${HEADERS} DESTINATION include/tmxparser)
install(TARGETS tmxparser tmxparser_static DESTINATION lib)